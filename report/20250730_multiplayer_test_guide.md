# マルチプレイヤー接続テストガイド

## テスト実行日時
2025年7月30日

## 概要
「マーケット・ディスラプション」のマルチプレイヤー機能が正常に動作することを確認するためのテストガイドです。

## 準備事項

### アクセスURL
- **フロントエンド**: https://market-disruption.netlify.app
- **バックエンド**: https://market-disruption-production.up.railway.app

### 必要な環境
- 複数のブラウザまたはデバイス（PC、スマートフォン、タブレット）
- 安定したインターネット接続
- 最新のブラウザ（Chrome、Firefox、Safari、Edge）

## テスト手順

### 1. 単体プレイヤーテスト

#### A. 基本動作確認
1. https://market-disruption.netlify.app にアクセス
2. プレイヤー名を入力
3. 「🤖 1人プレイ (オートマ対戦)」をクリック
4. ゲームが正常に開始されることを確認

#### B. アクション実行テスト
- ✅ **アルバイト** (2AP → 5資金): 正常実行確認
- ✅ **設計** (2AP): 正常実行確認
- ✅ **オープンソース設計** (2AP): 正常実行確認
- ✅ **日雇い労働** (3AP → 18資金): 正常実行確認
- ✅ **製造**: 設計図から商品製造確認
- ✅ **販売**: 商品価格設定確認

#### C. オートマフェーズテスト
1. 「オートマフェーズへ」ボタンをクリック
2. コンソールログでオートマアクション実行を確認
3. オートマ商品が市場に追加されることを確認
4. 市場フェーズで需要処理が実行されることを確認
5. 自動的にアクションフェーズに戻ることを確認

### 2. マルチプレイヤーテスト

#### A. ゲーム作成（ホスト）
1. ブラウザ1でhttps://market-disruption.netlify.app にアクセス
2. プレイヤー名を入力（例: "プレイヤー1"）
3. 「👥 複数人プレイ (最大4人)」をクリック
4. ゲームIDをメモ（例: multi-1722334567890）

#### B. ゲーム参加（ゲスト）
1. ブラウザ2（別デバイス/ブラウザ）でhttps://market-disruption.netlify.app にアクセス
2. 下部の「既存のゲームに参加」セクションを使用
3. ゲームIDを入力（ホストのゲームID）
4. プレイヤー名を入力（例: "プレイヤー2"）
5. プレイヤー選択で「プレイヤー 2」を選択
6. 「ゲームに参加」をクリック

#### C. 同期テスト
1. **ホスト側でアクション実行**
   - アルバイトや設計などのアクションを実行
   - 資金やAPの変化を確認

2. **ゲスト側で状態確認**
   - ホストのアクション結果が反映されることを確認
   - リアルタイムで状態が同期されることを確認

3. **ターン交代テスト**
   - ホストが「ターン終了」をクリック
   - ゲスト側に手番が移ることを確認
   - ゲスト側でアクションが実行可能になることを確認

#### D. フェーズ同期テスト
1. **アクションフェーズ→オートマフェーズ**
   - 「オートマフェーズへ」ボタンをクリック
   - 両方のブラウザで同時にフェーズが変化することを確認

2. **オートマ実行確認**
   - オートマアクションが実行されることを確認
   - 新しい商品が市場に追加されることを確認

3. **市場フェーズ→アクションフェーズ**
   - 市場での購入処理が実行されることを確認
   - 自動的にアクションフェーズに戻ることを確認

### 3. 追加プレイヤーテスト（3-4人）

#### A. 3人目の参加
1. ブラウザ3でゲームに参加
2. 「プレイヤー 3」を選択
3. 正常に参加できることを確認

#### B. 4人目の参加
1. ブラウザ4でゲームに参加
2. 「プレイヤー 4」を選択
3. 正常に参加できることを確認

#### C. 4人プレイでの動作確認
1. 順次ターンが回ることを確認
2. 各プレイヤーのアクションが全員に同期されることを確認
3. フェーズ変更が全員に適用されることを確認

## 期待される結果

### ✅ 正常動作項目
1. **接続性**
   - 複数ブラウザから同時接続可能
   - 安定したSocket.IO通信
   - 接続エラーなしで継続プレイ可能

2. **状態同期**
   - プレイヤーアクションのリアルタイム反映
   - 資金、AP、威厳の正確な同期
   - 商品の追加・削除の同期

3. **ターン管理**
   - 正確なターン順の維持
   - ターン終了時の適切な手番移行
   - アクティブプレイヤーの明確な表示

4. **フェーズ同期**
   - アクション→オートマ→市場フェーズの同期
   - オートマアクションの同時実行
   - 自動フェーズ遷移の同期

5. **ゲームロジック**
   - オートマ商品の生成と配置
   - 転売による市場汚染の増加
   - 需要システムによる購入処理
   - 勝利条件の正確な判定

## トラブルシューティング

### よくある問題と解決方法

#### 1. 接続エラー
**症状**: "接続に失敗しました"エラー
**解決方法**: 
- ブラウザを再読み込み
- 異なるブラウザで試行
- ネットワーク接続を確認

#### 2. ゲーム同期エラー
**症状**: プレイヤー間で状態が一致しない
**解決方法**:
- 両方のブラウザを再読み込み
- 新しいゲームを作成
- ブラウザの開発者ツールでエラーログを確認

#### 3. ターン進行の停止
**症状**: ターンが進まない/ボタンが反応しない
**解決方法**:
- ページを再読み込み
- アクティブプレイヤーを確認
- コンソールログでエラーを確認

#### 4. オートマフェーズが実行されない
**症状**: 「オートマフェーズへ」ボタンを押しても何も起こらない
**解決方法**:
- ブラウザのコンソールでログを確認
- フェーズ状態を確認
- サーバー接続状態を確認

## 技術的検証項目

### A. ネットワーク通信
- WebSocket接続の安定性
- Socket.IOイベントの送受信
- ハートビート/ping-pongの動作

### B. 状態管理
- boardgame.ioの状態同期機能
- ゲーム状態の整合性維持
- 競合状態の回避

### C. パフォーマンス
- 複数接続での応答性
- メモリ使用量の監視
- CPU使用率の確認

### D. エラーハンドリング
- 接続断の自動復旧
- 不正な操作の検出と拒否
- エラーメッセージの適切な表示

## テスト結果記録フォーマット

### 基本情報
- テスト実行者: 
- テスト日時: 
- 使用ブラウザ: 
- 参加人数: 

### 結果チェックリスト
- [ ] 1人プレイが正常動作
- [ ] 2人プレイで接続・同期が正常
- [ ] 3人プレイで正常動作
- [ ] 4人プレイで正常動作
- [ ] オートマフェーズが正常実行
- [ ] 市場フェーズが正常実行
- [ ] ターン管理が正確
- [ ] 勝利条件判定が正常
- [ ] エラーハンドリングが適切

### 問題報告
- 発生した問題: 
- エラーメッセージ: 
- 再現手順: 
- 解決方法: 

## 本番運用確認項目

### デプロイ状況
- ✅ Railway サーバーデプロイ完了
- ✅ Netlify フロントエンドデプロイ完了
- ✅ CORS設定適用済み
- ✅ 環境変数設定済み

### 監視項目
- サーバーの稼働状況
- 接続数の監視
- エラーログの監視
- パフォーマンスメトリクス

## まとめ

このテストガイドに従って検証を行うことで、「マーケット・ディスラプション」のマルチプレイヤー機能が本番環境で正常に動作することを確認できます。

全ての項目をクリアすることで、プレイヤーは異なるデバイスから同時接続し、リアルタイムでオートマとの戦略的対戦を楽しむことができます。